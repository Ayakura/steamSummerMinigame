!function(e){"use strict";function t(){return e.g_Minigame.m_CurrentScene}function n(){D("Starting /u/wchill's script (version "+$+")",1),se=t().DoCritEffect,ue=t().m_rgClickNumbers.push,pe=e.g_Minigame.Render,x(),q&&r(),K&&e.CEnemy&&(e.CEnemy.prototype.TakeDamage=function(){},e.CEnemySpawner.prototype.TakeDamage=function(){},e.CEnemyBoss.prototype.TakeDamage=function(){}),X&&C(),z&&v();var n=document.getElementById("abilities");n&&(n.style.textAlign="left"),W&&(n=document.getElementById("global_header"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.getElementById("footer"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.getElementById("footer_spacer"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.querySelector(".pagecontent"),n&&(n.style["padding-bottom"]=0),document.body.style.backgroundPosition="0 0"),V&&u(te),j&&O(),Q&&f(),void 0!==e.CSceneGame&&(e.CSceneGame.prototype.DoScreenShake=function(){}),i();var a=document.createElement("span");a.className="toggle_music_btn",a.textContent="Easter Egg",a.onclick=function(){e.SmackTV()},document.querySelector(".game_options").insertBefore(a,document.querySelector(".leave_game_btn"));var o=document.querySelector(".title_activity"),l=document.createElement("span");l.innerHTML='<span id="players_in_game">0/1500</span>&nbsp;Players in room<br>',o.insertBefore(l,o.firstChild);var p=document.getElementById("activitylog");p.style.marginTop="33px";var g=document.createElement("div");document.getElementsByClassName("pagecontent")[0].insertBefore(g,document.getElementsByClassName("footer_spacer")[0]),g.className="options_box";var _=document.querySelector(".options_box");_||(_=document.querySelector(".options_box")),_.innerHTML="<b>OPTIONS</b> (v"+$+')<br>Settings marked with a <span style="color:#FF5252;font-size:22px;line-height:4px;vertical-align:bottom;">*</span> requires a refresh to take effect.<hr>',_.className="options_box",_.style.backgroundColor="#000000",_.style.width="600px",_.style.marginTop="12px",_.style.padding="12px",_.style.boxShadow="2px 2px 0 rgba( 0, 0, 0, 0.6 )",_.style.color="#ededed",_.style.marginLeft="auto",_.style.marginRight="auto";var T=_.cloneNode(!0),S=document.createElement("div");S.style["-moz-column-count"]=3,S.style["-webkit-column-count"]=3,S.style["column-count"]=3,S.style.width="100%",S.appendChild(d("removeInterface","Remove interface",W,s,!0)),S.appendChild(d("removeParticles","Remove particle effects",q,s,!0)),S.appendChild(d("removeFlinching","Remove flinching effects",K,s,!0)),S.appendChild(d("removeCritText","Remove crit text",X,C,!1)),S.appendChild(d("removeGoldText","Remove gold text",Y,s,!1)),S.appendChild(d("removeAllText","Remove all text",z,v,!1)),S.appendChild(d("disableRenderer","Throttle game renderer",Q,f,!0)),("undefined"!=typeof GM_info||"undefined"!==e.usingMsgScript)&&S.appendChild(d("enableAutoRefresh","Enable auto-refresh",V,b,!1)),S.appendChild(d("enableFingering","Enable targeting pointer",j,s,!0)),S.appendChild(d("useTrollTracker","Track improper ability use",Z,s,!0)),S.appendChild(d("praiseGoldHelm","Praise Gold Helm!",ee,h,!1)),S.appendChild(m("praiseGoldHelmImage","",ce,me,y)),S.appendChild(c("setLogLevel","Change the log level","25px",H,0,5,E)),_.appendChild(S),T.innerHTML="<b>GAME INFO</b><br/>",T.className="info_box",T.style.right="0px",he=document.createElement("div"),he.style["-moz-column-count"]=3,he.style["-webkit-column-count"]=3,he.style["column-count"]=3,he.appendChild(document.createElement("div")),he.appendChild(document.createElement("div")),he.appendChild(document.createElement("div")),T.appendChild(he),_.parentElement.appendChild(T);var M=document.querySelector(".leave_game_helper");M.parentElement.removeChild(M),F(),U();var L=e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points,R=e.g_steamID%10+1;e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='25' data-cost='200'></a>"),R),L-=200*R;var N=Math.floor(L/200);e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='26' data-cost='100'></a>"),N),e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='27' data-cost='100'></a>"),N),e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='19' data-cost='1'></a>"),L%100)}function a(){for(var e={1:":shelterwildfire:",2:":waterrune:",3:":Wisp:",4:":FateTree:"},n=0;3>n;n++){var a=t().m_rgGameData.lanes[n].element,i=t().m_rgLaneData[n].abilities;i||(i={});for(var r=[],o=0;4>o;o++){var l=t().GetEnemy(n,o);l&&r.push(l)}var m=t().m_rgLaneData[n].players,c="Lane "+(n+1)+' - <img src="http://cdn.steamcommunity.com/economy/emoticon/'+e[a]+'"><br>'+m+" players";he.children[n].innerHTML=c}}function i(){ee?(e.$J(".tv_ui").css("background-image","url("+ce+")"),e.$J(".pagecontent").attr("style","padding-bottom: 0px; background-image: url('http://cdn.akamai.steamstatic.com/steamcommunity/public/images/items/368020/7b933b3766d64ec0525c86891dedb4b699a25fb9.jpg')")):e.$J(".tv_ui").css("background-image","url("+de+")"),e.$J("#activeinlanecontainer").css("height","154px"),e.$J("#activitycontainer").css("height","270px"),e.$J("#activityscroll").css("height","270px")}function r(){e.CSceneGame&&(e.CSceneGame.prototype.DoScreenShake=function(){},q&&(e.CSceneGame.prototype.SpawnEmitter=function(e){return e.emit=!1,e}))}function o(){var e=Math.floor(t().m_nTime)%86400;return e-=57600,0>e&&(e+=86400),86400-e}function l(){if(!oe){oe=!0;var t=J();if(10>t&&ge.useSlowMode)return;be.forEach(R),re=3*o()<A(ye.WORMHOLE)||3*o()<A(ye.LIKE_NEW),ie=t%ge.rainingRounds>0&&t%ge.rainingRounds<100-ge.rainingSafeRounds||re,a(),L()}e.CUI&&!_e&&(_e=!0,D("Anti nuke in effect",1),e.CUI.prototype.UpdateLog=function(t){this.m_Game.m_rgTuningData.abilities;if(this.m_Game.m_rgPlayerTechTree){for(var n=0,a=t.length-1;a>=0;a--){var i=t[a];if(isNaN(i.time)&&(i.time=this.m_nActionLogTime+1),!(i.time<=this.m_nActionLogTime)){switch(i.type){case"ability":var r=this.m_eleUpdateLogTemplate.clone();if(Z)if(J()%100===0&&[10,11,12,15,20].indexOf(i.ability)>-1){if(e.$J(r).data("abilityid",i.ability),e.BigNumber){var o=new e.BigNumber(i.actor);e.$J(".name",r).append('<a href="http://steamcommunity.com/profiles/'+o.plus(new e.BigNumber("76561197960265728"))+'" target="_blank" style="color: red; font-weight: bold;">'+i.actor_name+"</a>")}else e.$J(".name",r).text(i.actor_name);e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+J()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild),D(i.actor_name+" used "+this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+J(),1),e.$J(".name",r).attr("style","color: red; font-weight: bold;"),e.$J.ajax({type:"POST",url:"cerf.cs.ubc.ca:54321/report",crossDomain:!0,data:'{"name":rgEntry.actor_name, "steamid":rgEntry.actor, "round":getGameLevel(), "ability":rgEntry.ability, "time":rgEntry.time}',dataType:"json",success:function(e,t,n){D("Reported "+i.actor_name+" at time "+i.time,2)},error:function(e,t,n){console.log("POST failed.",2)}})}else J()%100!==0&&J()%10===9&&26===i.ability&&(e.$J(r).data("abilityid",i.ability),e.$J(".name",r).text(i.actor_name),e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+J()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(".name",r).attr("style","color: yellow"),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild));else e.$J(r).data("abilityid",i.ability),e.$J(".name",r).text(i.actor_name),e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+J()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild);break;default:console.log("Unknown action log type: %s",i.type),console.log(i)}i.time>n&&(n=i.time)}}n>this.m_nActionLogTime&&(this.m_nActionLogTime=n);for(var l=this.m_eleUpdateLogContainer[0];l.children.length>20;)l.children[l.children.length-1].remove()}},this.m_eleUpdateLogContainer&&(this.m_eleUpdateLogContainer[0].innerHTML=""))}function m(e,t,n,a,i){var r=document.createElement("label"),o=document.createTextNode(t),l=document.createElement("select");for(var m in a){var c=document.createElement("option");c.value=a[m],c.textContent=m,a[m]==n&&(c.selected=!0),l.appendChild(c)}return l.name=e,l.style.marginRight="5px",l.onchange=i,r.appendChild(l),r.appendChild(o),r.appendChild(document.createElement("br")),r}function c(t,n,a,i,r,o,l){var m=document.createElement("label"),c=document.createTextNode(n),d=document.createElement("input");return d.type="number",d.name=t,d.style.width=a,d.style.marginRight="5px",d.value=i,d.min=r,d.max=o,d.onchange=l,e[d.name]=d,m.appendChild(d),m.appendChild(c),m.appendChild(document.createElement("br")),m}function d(t,n,a,i,r){var o=document.createElement("span");o.appendChild(document.createTextNode("*")),o.style.color="#FF5252",o.style.fontSize="22px",o.style.lineHeight="14px",o.style.verticalAlign="bottom";var l=document.createElement("label"),m=document.createTextNode(n),c=document.createElement("input");return c.type="checkbox",c.name=t,c.checked=a,c.onclick=i,e[c.name]=c.checked,l.appendChild(c),l.appendChild(m),r&&l.appendChild(o),l.appendChild(document.createElement("br")),l}function s(e){g(e)}function u(e){var t=60*(e+ne*Math.random())*1e3;le=setTimeout(function(){p()},t)}function p(){var n=t().GetEnemy(t().m_rgPlayerData.current_lane,t().m_rgPlayerData.target).m_data;if("undefined"!=typeof n){var a=n.type;a!=fe.BOSS?(D("Refreshing, not boss",5),e.location.reload(!0)):(D("Not refreshing, A boss!",5),setTimeout(p,3e3))}else setTimeout(p,1e3)}function g(t){var n=t.target;return T(n.name,n.checked),e[n.name]=n.checked,n.checked}function _(t){var n=t.target;return T(n.name,n.value),e[n.name]=n.value,n.value}function h(e){void 0!==e&&(ee=g(e)),i()}function y(e){void 0!==e&&(ce=_(e)),i()}function b(e){var t=V;void 0!==e&&(t=g(e)),t?u(te):clearTimeout(le)}function f(t){var n=Q;void 0!==t&&(n=Q=g(t));var a=e.PIXI.ticker.shared;n?(a.autoStart=!1,a.stop(),e.g_Minigame.Render=function(){}):(a.autoStart=!0,a.start(),e.g_Minigame.Render=pe,e.g_Minigame.Render())}function C(e){var n=X;void 0!==e&&(n=g(e)),n?t().DoCritEffect=function(e,t,n,a){}:t().DoCritEffect=se}function v(e){var n=z;void 0!==e&&(n=g(e)),n?t().m_rgClickNumbers.push=function(e){e.container.removeChild(e)}:t().m_rgClickNumbers.push=ue}function E(e){void 0!==e&&(H=e.target.value)}function T(e,t){try{void 0!==localStorage&&localStorage.setItem("steamdb-minigame/"+e,t)}catch(n){console.log(n)}}function S(e,t){try{if(void 0!==localStorage){var n=localStorage.getItem("steamdb-minigame/"+e);return null!==n?n:t}}catch(a){return console.log(a),t}}function M(e,t){return"true"==S(e,t.toString())}function x(){for(var e=document.querySelector('a.link.element_upgrade_btn[data-type="3"]'),t=document.querySelector('a.link.element_upgrade_btn[data-type="4"]'),n=document.querySelector('a.link.element_upgrade_btn[data-type="5"]'),a=document.querySelector('a.link.element_upgrade_btn[data-type="6"]'),i=[e,t,n,a],r=0;r<i.length;r++)i[r].style.visibility="hidden"}function L(){t().m_bIsDead&&t().m_rgPlayerData.time_died+5<t().m_nTime&&e.RespawnPlayer()}function R(e){N(e,!1)}function N(t,n){n?(e.$J("#ability_"+t).show(),e.$J("#abilityitem_"+t).show()):(e.$J("#ability_"+t).hide(),e.$J("#abilityitem_"+t).hide())}function A(e){for(var n=0;n<t().m_rgPlayerTechTree.ability_items.length;++n){var a=t().m_rgPlayerTechTree.ability_items[n];if(a.ability==e)return a.quantity}return 0}function D(e,t){H>=t&&console.log(e)}function P(){return 100*t().m_rgPlayerTechTree.crit_percentage}function I(){return t().m_rgPlayerTechTree.damage_multiplier_crit}function G(){return t().m_rgPlayerTechTree.dps}function k(){return t().m_rgPlayerTechTree.damage_per_click}function B(){return t().m_rgPlayerTechTree.damage_per_click_multiplier}function w(){return 100*t().m_rgPlayerTechTree.boss_loot_drop_percentage}function O(){e.CSceneGame.prototype.ClearNewPlayer=function(){},t().m_spriteFinger||(e.WebStorage.SetLocal("mg_how2click",0),t().CheckNewPlayer(),e.WebStorage.SetLocal("mg_how2click",1)),document.getElementById("newplayer").style.display="none"}function F(){var t=e.fnTooltipUpgradeDesc;e.fnTooltipUpgradeDesc=function(n){var a=e.$J(n),i=a.data("desc"),r=i,o=parseFloat(a.data("multiplier"));switch(a.data("upgrade_type")){case 2:r=t(n);var l=k()*I(),m=e.g_Minigame.CurrentScene().m_rgTuningData.player.damage_per_click*(B()+o)*I();r+="<br><br>Crit Click: "+e.FormatNumberForDisplay(l)+" => "+e.FormatNumberForDisplay(m);break;case 7:var c=I(),d=c+o,s=G(),u=k();r+="<br><br>You can have multiple crits in a second. The server combines them into one.",r+="<br><br>Crit Percentage: "+P().toFixed(1)+"%",r+="<br><br>Critical Damage Multiplier:",r+="<br>Current: "+c+"x",r+="<br>Next Level: "+d+"x",r+="<br><br>Damage with one crit:",r+="<br>DPS: "+e.FormatNumberForDisplay(c*s)+" => "+e.FormatNumberForDisplay(d*s),r+="<br>Click: "+e.FormatNumberForDisplay(c*u)+" => "+e.FormatNumberForDisplay(d*u),r+="<br><br>Base Increased By: "+o.toFixed(1)+"x";break;case 9:r+="<br><br>Boss Loot Drop Rate:",r+="<br>Current: "+w().toFixed(0)+"%",r+="<br>Next Level: "+(w()+100*o).toFixed(0)+"%",r+="<br><br>Base Increased By: "+e.FormatNumberForDisplay(100*o)+"%";break;default:return t(n)}return r}}function J(){return t().m_rgGameData.level+1}function U(){var t=20,n=setInterval(function(){var a=e.$J(".spend_badge_ponts_ctn"),i=!!(a&&a.length&&a.is(":visible"));i?(window.document.dispatchEvent(new Event("event:welcomePanelVisible")),clearInterval(n)):e.g_Minigame&&e.g_Minigame.CurrentScene()&&e.g_Minigame.CurrentScene().m_rgPlayerTechTree&&!e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points?clearInterval(n):--t<=0&&clearInterval(n)},500)}var $="7.0.3",H=1,W=M("removeInterface",!0),q=M("removeParticles",!0),K=M("removeFlinching",!0),X=M("removeCritText",!1),Y=M("removeGoldText",!1),z=M("removeAllText",!1),V=M("enableAutoRefresh","undefined"!=typeof GM_info||!!e.usingMsgScript),j=M("enableFingering",!0),Q=M("disableRenderer",!1),Z=M("useTrollTracker",!1),ee=M("praiseGoldHelm",!0),te=30,ne=10,ae=30,ie=!1,re=!1,oe=!1,le=null,me={"Original Gold Helm":"https://i.imgur.com/1zRXQgm.png","Moving Gold Helm":"http://i.imgur.com/XgT8Us8.gif","Golden Gaben":"http://i.imgur.com/ueDBBrA.png","Gaben + Snoop Dogg":"http://i.imgur.com/9R0436k.gif","Wormhole Gaben":"http://i.imgur.com/6BuBgxY.png",MSG2015:"http://i.imgur.com/zHI6C6X.png","Matrix Gaben":"http://i.imgur.com/titbsfQ.png","Praising Intensifies":"http://i.imgur.com/1ynXett.gif"},ce=S("praiseGoldHelmImage",me["Golden Gaben"]),de="http://i.imgur.com/ieDoLnx.png",se=function(){},ue=function(){},pe=function(){},ge={speedThreshold:2e3,rainingSafeRounds:25,rainingRounds:100,timePerUpdate:6e4,useSlowMode:!1,minsLeft:60,allowWormholeLevel:18e4,githubVersion:$,useLikeNewMinChance:.02,useLikeNewMaxChance:1,useGoldThreshold:200},_e=!1,he=(M("showedUpdateInfo",!1),{}),ye={FIRE_WEAPON:1,CHANGE_LANE:2,RESPAWN:3,CHANGE_TARGET:4,MORALE_BOOSTER:5,GOOD_LUCK_CHARMS:6,MEDICS:7,METAL_DETECTOR:8,DECREASE_COOLDOWNS:9,TACTICAL_NUKE:10,CLUSTER_BOMB:11,NAPALM:12,RESURRECTION:13,CRIPPLE_SPAWNER:14,CRIPPLE_MONSTER:15,MAX_ELEMENTAL_DAMAGE:16,RAINING_GOLD:17,CRIT:18,PUMPED_UP:19,THROW_MONEY_AT_SCREEN:20,GOD_MODE:21,TREASURE:22,STEAL_HEALTH:23,REFLECT_DAMAGE:24,FEELING_LUCKY:25,WORMHOLE:26,LIKE_NEW:27},be=[ye.TACTICAL_NUKE,ye.CLUSTER_BOMB,ye.NAPALM,ye.CRIPPLE_MONSTER,ye.MAX_ELEMENTAL_DAMAGE,ye.THROW_MONEY_AT_SCREEN,ye.TREASURE,ye.STEAL_HEALTH,ye.REFLECT_DAMAGE,ye.FEELING_LUCKY],fe=([ye.MORALE_BOOSTER,ye.GOOD_LUCK_CHARMS,ye.TACTICAL_NUKE,ye.CLUSTER_BOMB,ye.NAPALM,ye.CRIT,ye.CRIPPLE_SPAWNER,ye.CRIPPLE_MONSTER,ye.MAX_ELEMENTAL_DAMAGE,ye.REFLECT_DAMAGE,ye.THROW_MONEY_AT_SCREEN],{SPAWNER:0,CREEP:1,BOSS:2,MINIBOSS:3,TREASURE:4});r(),e.SteamDB_Minigame_Timer&&e.clearInterval(e.SteamDB_Minigame_Timer),e.SteamDB_Minigame_Timer=e.setInterval(function(){e.g_Minigame&&t().m_bRunning&&t().m_rgPlayerTechTree&&t().m_rgGameData&&(e.clearInterval(e.SteamDB_Minigame_Timer),n(),e.SteamDB_Minigame_Timer=e.setInterval(l,1e3))},1e3),e.setTimeout(function(){e.g_Minigame&&e.g_Minigame.m_CurrentScene&&e.g_Minigame.m_CurrentScene.m_rgGameData||e.location.reload(!0)},1e3*ae);var Ce=document.querySelector(".breadcrumbs");if(Ce){var ve=document.createElement("span");ve.textContent=" > ",Ce.appendChild(ve),ve=document.createElement("span"),ve.style.color="#D4E157",ve.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",ve.textContent="Room "+e.g_GameID,Ce.appendChild(ve),ve=document.createElement("span"),ve.textContent=" > ",Ce.appendChild(ve),ve=document.createElement("span"),ve.style.color="#FFA07A",ve.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",ve.textContent="Level: 0, Expected Level: 0, Likely Level: 0",Ce.appendChild(ve),document.ExpectedLevel=ve,ve=document.createElement("span"),ve.textContent=" > ",Ce.appendChild(ve),ve=document.createElement("span"),ve.style.color="#9AC0FF",ve.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",ve.textContent="Remaining Time: 0 hours, 0 minutes.",Ce.appendChild(ve),document.RemainingTime=ve}e.document.addEventListener("event:welcomePanelVisible",function(){e.$J("#badge_items > .purchase_ability_item > .sub_item").each(function(){var t=e.$J(this),n=e.$J('<div class="sub_item x100">x100</div>');n.click(function(t){e.g_Minigame.CurrentScene().TrySpendBadgePoints(this,100),t.stopPropagation()}),n.data(t.data()),t.css("margin-right","50px"),t.after(n)});var t=e.g_Minigame.CurrentScene().m_UI.UpdateSpendBadgePointsDialog;e.g_Minigame.CurrentScene().m_UI.UpdateSpendBadgePointsDialog=function(){t.apply(e.g_Minigame.CurrentScene().m_UI,arguments);var n=e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points;e.$J("#badge_items > .purchase_ability_item > .sub_item.x100").each(function(){var t=e.$J(this);n<100*t.data().cost?t.addClass("disabled"):t.removeClass("disabled")})}},!1)}(window);